<!doctype html>
<html>

<head>
    <title>Calendar from RDF</title>
    <meta charset="utf-8" />
    <script src="https://rdf-ext.bergnet.org/dist/rdf-ext-all-1.0.0.src.js"></script>
    <script src="rdfToArrayTimeStamps.js"></script>
</head>

<body>

<base href="https://raw-dot-custom-elements.appspot.com/onuridrisoglu/calendar-component/1.0.1-beta/calendar-component/">
<script src="../webcomponentsjs/webcomponents-lite.js"></script>
<link rel="import" href="calendar-component.html">
	<script>
	    	document.addEventListener('WebComponentsReady', function() {
	    		var calendar = document.querySelector('calendar-component');
	    		document.addEventListener('EventClicked', function(e) {
	      			alert('Event clicked : ['+e.detail.subject+']');
	      	});
		})
	  </script>

<!--calendar-component active-date="2018-08-01" items='[{"date":"2018-08-08","subject":"Meeting"}, {"date":"2018-08-14","subject":"Dentist Appointment"}, {"date":"2018-08-24","subject":"Dinner with JMV"}]'></calendar-component
<calendar-component active-date="2019-01-01" >
 -->

<calendar-component active-date="2019-06-01" >

</body>

<script>
	 function getParameterByName(name, url) {
		  if (!url) url = window.location.href;
		    name = name.replace(/[\[\]]/g, "\\$&");
		  var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
		        results = regex.exec(url);
		  // console.log("getParameterByName: results") ; console.log(results)
		  if (!results) return null;
		  if (!results[2]) return '';
		  return /* decodeURIComponent*/(results[2].replace(/\+/g, " "));
		}

 var loadVal = getParameterByName("url")
 console.log("loadVal URL " + loadVal);
 if (loadVal != null) {
   var url = loadVal
   console.log("URL " + url);
   var calendar = document.querySelector('calendar-component')
   let jsonDataFromRdf = rdfCalendar_rdfToArrayTimeStamps( url )
   jsonDataFromRdf.then(result => {
      let events = result["@graph"]
      let eventsForCalendar = events . map ( event => {
        return { "date": event.date ,
                 "subject":  event.subject["@value"] }
      })
      console.log( JSON.stringify(eventsForCalendar) )
      calendar . items = eventsForCalendar
  })
  .catch((err) => { console.error(err.stack || err.message) })

 } else
     console.log("No url= in URL ");
</script>

</html>

